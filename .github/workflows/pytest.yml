---
name: pytest

on:
    pull_request:
        branches:
            - trunk
    push:
        branches:
            - trunk

jobs:
    pytest:

        strategy:
            matrix:
                os: [macos-latest, ubuntu-latest, windows-latest]
                python-version: ["3.9", "3.10", "3.11", "3.12"]

        runs-on: ${{ matrix.os }}
        steps:
            - uses: actions/checkout@v4

            - name: Setup Python ${{ matrix.python-version }}
              uses: actions/setup-python@v4
              with:
                  python-version: ${{ matrix.python-version }}

            - name: Upgrade pip
              run: python -m pip install --upgrade pip

            - name: Install Dependencies
              run: pip install -r requirements.txt

            - name: Install pytest
              run: pip install pytest

            - name: Run Tests
              shell: bash
              env:
                  OS: ${{ matrix.os }}
                  PYTHON_VERSION: ${{ matrix.python-version }}
              run: |
                  report="pytest-$OS-python-$PYTHON_VERSION.rpt"
                  python -m pytest --verbose 2>&1 | tee $report

            - name: Save Report
              uses: actions/upload-artifact@v3
              with:
                  # yamllint disable rule:line-length
                  name: pytest-${{ matrix.os }}-python-${{ matrix.python-version }}.rpt
                  path: pytest-${{ matrix.os }}-python-${{ matrix.python-version }}.rpt
                  # yamllint enable rule:line-length
